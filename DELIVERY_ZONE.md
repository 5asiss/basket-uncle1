# 배송구역 설정 (일반 폴리곤 · 퀵 폴리곤 · 그 외 배송불가)

주문 시 **주소를 확인**해 **일반 폴리곤**이면 배송가능으로 주문 접수, **퀵 폴리곤**이면 추가 배송료 동의 시 퀵으로 주문 접수, **그 외**는 배송불가 처리됩니다.

---

## 1. 주문/결제 기준 구역 구분

| 구역 | 동작 |
|------|------|
| **일반 폴리곤** | 배송가능 지역 → **주문 접수** (추가료 없음) |
| **퀵 폴리곤** | 배송지역 아님. **「배송료 추가 시 퀵으로 배송됩니다. 추가하시고 주문하시겠습니까?」** 안내 → 동의 시 **추가 배송료(기본 10,000원)** 포함해 **주문 접수** |
| **그 외** | **배송불가** (결제 불가, 주소 수정 유도) |

- 판단: `get_delivery_zone_type(주소)` → `'normal'` | `'quick'` | `'unavailable'`
- 일반 폴리곤: 지도에서 설정한 **일반 배송구역(폴리곤)** 안에 주소가 있을 때
- 퀵 폴리곤: **퀵지역 폴리곤** 안에만 있고 일반 폴리곤 밖일 때
- 퀵 지역명(텍스트)만 있으면 `normal`로 처리 (추가료 없음)

---

## 2. 퀵 추가 배송료 · 안내 문구 (수정 가능)

- **관리자** → **배송구역관리** 탭 → **「퀵 지역 추가 배송료 · 안내 문구」** 블록
- **퀵 추가 배송료 (원)**: 숫자 입력 (기본 10,000원), 저장 시 결제 시 해당 금액 추가
- **퀵 배송 안내 문구**: 결제 전 고객에게 보이는 문구. 예: *"해당 주소는 배송지역이 아닙니다. 배송료 추가 시 퀵으로 배송됩니다. 추가하시고 주문하시겠습니까?"*
- 저장 시 `DeliveryZone.quick_extra_fee`, `quick_extra_message` 에 반영됨

---

## 3. 퀵지역 설정 (지도 좌표 / 지역명)

- **지도에서 퀵지역 폴리곤**: 편집 모드 「퀵지역 폴리곤」 선택 후 클릭해 꼭짓점 저장
- **지역명 입력**: 쉼표 구분 (예: 송도동, 선린동) — 주소에 포함되면 배송가능(추가료 없음)
- 퀵지역 좌표가 있으면 좌표 기준이 우선 적용됨

---

## 4. 적용 위치

| 위치 | 동작 |
|------|------|
| **회원가입** | 배송가능 구역(일반/퀵/이름) 외 주소는 가입 불가 |
| **마이페이지 주소 수정** | 배송가능 구역 외로 변경 시 저장 불가 |
| **주문 확인(/order/confirm)** | 주소로 `normal`/`quick`/`unavailable` 표시, 퀵일 때 안내 문구 + 동의 체크 + 추가료 표시 |
| **결제** | 퀵 구역이면 동의 시 `quick_extra_fee` 포함 금액으로 결제, 주문에 `quick_extra_fee` 저장 |

---

## 5. DB·API

- **DeliveryZone**: `polygon_json`, `quick_region_polygon_json`, `quick_region_names`, `quick_extra_fee`, `quick_extra_message`
- **Order**: `quick_extra_fee` (해당 주문에 적용된 퀵 추가료)
- **API**: `GET/POST /admin/delivery_zone/api` — 폴리곤·퀵지역·퀵 추가료·안내 문구 조회/저장

---

요약: **일반 폴리곤 = 배송가능 주문 접수, 퀵 폴리곤 = 안내 후 추가료 동의 시 주문 접수, 그 외 = 배송불가**. 추가 배송료와 안내 문구는 관리자 화면에서 수정 가능합니다.

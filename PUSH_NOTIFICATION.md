# 푸시 알림 설정 방법

이 프로젝트는 **브라우저 Web Push(VAPID)** 를 사용합니다.  
카카오/네이버 앱 전용 푸시 API가 아니라, **Chrome·Safari 등 브라우저**에서 동작하는 표준 푸시 알림입니다.

---

## 1. 관리자: 서버에 푸시 알림 켜기

### 1-1. VAPID 키 생성

프로젝트 루트에서:

```bash
pip install py-vapid
python generate_vapid_keys.py
```

출력된 `VAPID_PUBLIC_KEY`, `VAPID_PRIVATE_KEY` 두 줄을 복사합니다.

### 1-2. .env에 추가

`.env` 파일에 다음을 추가(또는 수정):

```env
# 푸시 알림 (선택)
VAPID_PUBLIC_KEY=생성된_공개키_값
VAPID_PRIVATE_KEY=생성된_비밀키_값
# 선택: 메일토 (푸시 구독 식별용)
VAPID_SUB_MAILTO=mailto:admin@example.com
```

### 1-3. 서버 재시작

- 로컬: Flask 프로세스 다시 실행
- Render 등: 환경 변수 저장 후 서비스 재배포(또는 자동 재시작)

설정이 되면 **마이페이지**에 「알림 켜기」 버튼이 활성화되고, `/api/push/vapid-public` 요청 시 공개키가 반환됩니다.

---

## 2. 이용자: 알림 받기

1. **로그인** 후 **마이페이지** 이동
2. **「알림 켜기」** 버튼 클릭
3. 브라우저에서 **알림 허용** 선택

이후 주문·배송 관련 메시지가 있으면 **브라우저 푸시 알림**으로 받을 수 있습니다.

---

## 3. 카카오/네이버 앱과의 관계

- **카카오톡·네이버 앱 안에서** 링크를 눌러 열린 **인앱 브라우저**에서는 푸시 알림을 **지원하지 않습니다** (브라우저 제약).
- 푸시 알림을 받으려면:
  - **Chrome**, **Safari** 등 **일반 브라우저**에서
  - **https** 주소로 사이트에 접속한 뒤
  - 마이페이지에서 「알림 켜기」를 해야 합니다.

즉, **카카오 로그인**은 사용할 수 있지만, **푸시 알림**은 카카오 앱 내 창이 아닌 **브라우저**에서만 동작합니다.

---

## 4. 배포 시 (Render 등)

Render 대시보드 → 해당 서비스 → **Environment** 에서:

| 변수명 | 설명 |
|--------|------|
| `VAPID_PUBLIC_KEY` | `generate_vapid_keys.py` 로 생성한 공개키 |
| `VAPID_PRIVATE_KEY` | 동일하게 생성한 비밀키 (Secret 권장) |
| `VAPID_SUB_MAILTO` | 선택. 예: `mailto:admin@yourdomain.com` |

저장 후 재배포하면 푸시 알림이 활성화됩니다.

---

## 5. 문제 해결

| 증상 | 확인 사항 |
|------|-----------|
| 「알림 기능이 설정되지 않았습니다」 | `.env`에 `VAPID_PUBLIC_KEY`, `VAPID_PRIVATE_KEY` 가 있는지, 서버 재시작 여부 |
| 알림 켜기 버튼이 동작하지 않음 | **https** 로 접속했는지 (http에서는 푸시 불가) |
| 카카오/네이버 앱 안에서만 안 됨 | 인앱 브라우저 미지원. Chrome/Safari에서 주소창에 URL 직접 입력해 접속 후 알림 켜기 |

---

**요약**: 푸시 알림 = **VAPID 키 설정** → 이용자는 **마이페이지에서 알림 켜기**. 카카오 앱 내부가 아닌 **일반 브라우저(https)** 에서만 동작합니다.

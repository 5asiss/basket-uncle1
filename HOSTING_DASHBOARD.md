# 호스팅 대시보드 설정 — "0.0.0.0에서 열린 HTTP 포트가 감지되지 않았습니다" 해결

이 메시지가 나오면 호스팅 사이트의 **대시보드**에서 아래 세 가지를 반드시 맞춰 주세요.  
(코드 수정이 아니라 **호스팅 설정**입니다.)

---

## 1. 시작 명령 (Start Command)

대시보드의 **Start Command** / **실행 명령** / **시작 스크립트** 란에 **아래를 그대로** 넣으세요.

```bash
gunicorn --bind 0.0.0.0:$PORT --timeout 300 app:app
```

- `$PORT`는 **환경 변수**라서 그대로 두세요. (Render, basam.co.kr 등은 보통 자동으로 넣어 줍니다.)
- 플랫폼이 `%PORT%` 또는 `{{PORT}}` 형식만 지원하면, 그에 맞게만 바꾸세요. 예: `0.0.0.0:%PORT%`

**주의:** `python app.py`만 쓰는 플랫폼이면, **환경 변수 `PORT`**를 아래 2번처럼 꼭 설정하세요.

---

## 2. PORT 환경 변수

대시보드의 **Environment** / **환경 변수** 메뉴에서:

| 이름   | 값        | 비고 |
|--------|------------|------|
| `PORT` | (플랫폼 안내값) | 플랫폼이 "기본 포트 8080" 등으로 안내하면 `8080` 입력. 안내가 없으면 **비워 두거나** `10000` 등 하나 지정 후 저장. |

- **PORT를 자동으로 넣어 주는 호스팅**(예: Render)이면 이 변수를 **추가하지 않아도** 됩니다.
- **직접 지정해야 하는 호스팅**이면, 사용 가능한 포트 번호(예: `8080`, `10000`)를 하나 정해 넣으세요.

---

## 3. 대기 시간 / 헬스체크 타임아웃

앱이 DB·마이그레이션 때문에 **30초 넘게** 올라올 수 있어서, 대기 시간이 짧으면 "포트가 감지되지 않았습니다"가 납니다.  
**Gunicorn이 `0.0.0.0:10000에서 청취 중`이라고 나와도**, Render가 **첫 포트 스캔을 너무 일찍** 하면 "0.0.0.0에서 열린 HTTP 포트가 감지되지 않았습니다. 스캔을 계속합니다"가 잠깐 뜰 수 있습니다.

대시보드에서 아래 중 해당하는 항목을 찾아 **60초 이상**(가능하면 **90~120초**)으로 설정하세요.

- **시작 대기 시간** / Startup timeout  
- **헬스체크 타임아웃** / Health check timeout  
- **포트 감지 대기 시간** / Port detection timeout  

예: `60` 또는 `120` (초)

**render.yaml 사용 시:** `healthCheckPath: /health` 가 설정되어 있으면, 포트가 열린 뒤 `/health` 로 헬스체크를 하므로 포트 감지 후 곧바로 준비 완료로 인식됩니다.

---

## 4. 적용 순서

1. 위 1~3을 대시보드에 입력/수정
2. **저장** 후 **재배포**(Redeploy / 다시 배포)
3. 배포 로그에서 "0.0.0.0에서 열린 HTTP 포트가 감지되지 않았습니다"가 **사라졌는지** 확인
4. 브라우저에서 서비스 URL(예: https://basam.co.kr)로 접속해 동작 확인

---

## 5. 체크리스트 (복사용)

배포 전에 아래만 확인하면 됩니다.

- [ ] **시작 명령:** `gunicorn --bind 0.0.0.0:$PORT --timeout 300 app:app`
- [ ] **PORT:** 플랫폼이 자동 설정하면 생략, 아니면 예: `8080` 또는 `10000` 설정
- [ ] **시작/헬스체크 대기:** 60초 이상(권장 90~120초)
- [ ] 설정 **저장** 후 **재배포**

이렇게 맞춘 뒤 재배포하면 "포트 미감지" 메시지가 사라지고 접속이 됩니다.

---

## 6. 업로드 이미지가 서버에서 안 나올 때 (Render 등)

Render는 **디스크가 휘발성**이라 `static/uploads/`에 저장한 파일은 재시작·재배포 시 사라집니다.  
**상품/리뷰/팝업 이미지가 계속 보이게 하려면** 환경 변수 **`CLOUDINARY_URL`**을 설정하세요.

| 이름 | 값 | 비고 |
|------|-----|------|
| `CLOUDINARY_URL` | `cloudinary://API_KEY:API_SECRET@CLOUD_NAME` | [Cloudinary](https://cloudinary.com) 가입 후 대시보드에서 확인 |

- 설정 후 **이미지 올리기·상품 등록·대량등록** 시 자동으로 Cloudinary에 저장되어 서버 재시작 후에도 이미지가 유지됩니다.
- 설정하지 않으면 로컬 `static/uploads/`만 사용하므로, Render에서는 배포 후 이미지가 사라질 수 있습니다.
